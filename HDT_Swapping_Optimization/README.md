# 深度集成 HDT-EV-Grid 协同优化框架


基于Python、Pyomo和NetworkX构建的、深度集成的混合整数线性规划（MILP）框架。在包含真实路网、动态能耗和随机需求的场景下，对换电重卡（HDT）车队、社会电动车（EV）充电服务及能源站运营进行统一的、最优的协同调度。

## 核心特性与深度

1.  **高保真路网模拟**: 使用 `NetworkX` 构建城市路网拓扑，并采用 **A* 寻路算法** 计算车辆在节点间的真实最短路径，彻底摒弃了不切实际的直线距离。
2.  **深度HDT任务调度**:
    -   采用强大的 **MTZ (Miller-Tucker-Zemlin) 序列建模**，直接对车辆的访问顺序进行优化。
    -   实现了**基于载重的动态能耗计算模型**，使电量消耗与HDT的运输状态紧密耦合。
    -   包含了换电站的**服务能力（工位数量）约束**，模拟了潜在的排队与冲突。
3.  **精巧的HDT-EV协同**:
    -   模型不再被动接受EV负荷，而是**主动决策**为EV充电所分配的能源来源（电网、光伏或B2V）。
    -   通过引入**服务未满足惩罚**，使模型能够在“保障EV服务”和“降低自身成本”之间做出智能的、经济上的权衡。
4.  **模块化与可扩展性**: 代码被清晰地组织在不同的模块中（配置、数据、模拟、建模、分析），具有极高的可读性和可扩展性。
5.  **专业级结果可视化**: 自动生成HDT在真实路网上的路径图和能源站的多维度能源调度图，使结果直观易懂。

## 环境配置

1.  **Python**: 3.8 或更高版本。
2.  **依赖库**:
    ```bash
    pip install pandas pyomo networkx matplotlib
    ```
3.  **MILP求解器**:
    -   **Gurobi**
    -   **CPLEX**: 

## 如何运行

1.  **创建项目结构**:
    ```bash
    python create_project_structure.py
    ```
2.  **填入代码**: 所有 `.py` 代码文件。
3.  **配置运行模式**:
    -   打开 `src/common/config_final.py`。
    -   **`RUN_SIMPLE_VERSION = True`**: 首次运行或快速调试时使用，问题规模较小，求解快。
    -   **`RUN_SIMPLE_VERSION = False`**: 用于正式的、完整的分析，问题规模大，求解时间长。
4.  **执行主工作流**:
    ```bash
    python main_workflow_final.py
    ```
5.  **查看结果**:
    -   求解日志会实时打印在控制台。
    -   求解成功后，脚本会自动调用分析模块。
    -   所有生成的图表（如`hdt_routing_plan.png`）和数据文件将被保存在 `results/` 文件夹中。

使用Gurobi，在“完整版”模式下求解也可能需要数十分钟到一个小时以上的时间，具体取决于计算机性能。