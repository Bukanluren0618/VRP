# HDT_Swapping_Optimization/src/common/config_final.py
import os

# --- 路径定义 ---
PROJECT_ROOT = os.path.dirname(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))
RESULTS_DIR = os.path.join(PROJECT_ROOT, "results")
DATA_DIR = os.path.join(PROJECT_ROOT, "data", "raw")
os.makedirs(RESULTS_DIR, exist_ok=True)

# --- 文件名定义 ---
CHARGE_LOAD_FILENAME = "充电负荷报表-海宜路1、2号5月.csv"
BATTERY_SOC_FILENAME = "电池SOC数据.csv"

# --- [最终验证场景] ---
# 使用一个极简、清晰的单车场景来验证最终算法
CITY_NODE_COUNT = 50       # 减小路网规模以便快速运行
CITY_GRAPH_RADIUS = 0.25   # 增大连接半径，确保路径存在
NUM_DEPOTS = 1
NUM_TRUCKS = 1             # **核心修改：强制单车场景**
NUM_STATIONS = 5           # 保证有足够的换电站
NUM_CUSTOMERS = 10         # 少量客户点
MIN_TASKS_PER_TRUCK = 1
MAX_TASKS_PER_TRUCK = 8    # loader会为这1辆车生成最多8个任务

DISTANCE_DIVISOR = 100.0

# --- 时间离散化 ---
TIME_HORIZON_HOURS = 24
TIME_STEP_MINUTES = 30
TOTAL_TIME_STEPS = int(TIME_HORIZON_HOURS * 60 / TIME_STEP_MINUTES)
TIME_STEP_HOURS = TIME_STEP_MINUTES / 60.0

# --- 经济与惩罚参数 ---
MANPOWER_COST_PER_HOUR = 150.0
DELAY_PENALTY_PER_HOUR = 800.0
FIXED_SWAP_COST = 50.0
EV_UNSERVED_PENALTY_PER_KWH = 10.0
GRID_PEAK_PRICE_PENALTY = 50.0
UNASSIGNED_TASK_PENALTY = 2000000.0
AVG_TASKS_PER_TRUCK = 5
MAX_WORKING_HOURS_PER_TRUCK = 12.0

# --- HDT 物理参数 (使用健壮的参数) ---
LOADING_UNLOADING_TIME_HOURS = 0.5
SWAP_DURATION_HOURS = 0.25
HDT_BATTERY_CAPACITY_KWH = 350.0
HDT_MIN_SOC_KWH = HDT_BATTERY_CAPACITY_KWH * 0.20
HDT_EMPTY_WEIGHT_TON = 10.0
HDT_BASE_CONSUMPTION_KWH_PER_KM = 1.2
HDT_WEIGHT_CONSUMPTION_KWH_PER_KM_TON = 0.05

# --- EV & 能源站参数 ---
EV_AVG_CHARGE_DEMAND_KWH = 40.0
EV_MAX_CHARGE_POWER_KW = 60.0
BATTERY_CHARGE_EFFICIENCY = 0.95
BATTERY_DISCHARGE_EFFICIENCY = 0.95
BATTERY_MAX_CHARGE_POWER_KW = 120
STATION_MAX_GRID_POWER_KW = 2000
PV_PEAK_POWER_KW = 500

# --- 求解器与模型 ---
SOLVER_NAME = 'gurobi'
TIME_LIMIT_SECONDS = 600
BIG_M = 10000