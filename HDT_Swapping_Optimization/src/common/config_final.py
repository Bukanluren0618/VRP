# HDT_Swapping_Optimization/src/common/config_final.py
import os

# --- 路径定义 ---
PROJECT_ROOT = os.path.dirname(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))
RESULTS_DIR = os.path.join(PROJECT_ROOT, "results")
DATA_DIR = os.path.join(PROJECT_ROOT, "data", "raw")
os.makedirs(RESULTS_DIR, exist_ok=True)

# --- 文件名定义 ---
CHARGE_LOAD_FILENAME = "充电负荷报表-海宜路1、2号5月.csv"
BATTERY_SOC_FILENAME = "电池SOC数据.csv"

# --- 城市配送场景参数 ---
CITY_NODE_COUNT = 150
CITY_GRAPH_RADIUS = 0.15
NUM_DEPOTS = 5
NUM_TRUCKS = 1
NUM_STATIONS = 10
NUM_CUSTOMERS = 80
MIN_TASKS_PER_TRUCK = 3
MAX_TASKS_PER_TRUCK = 10 # 适当放宽单车最大任务数
DISTANCE_DIVISOR = 100.0

# --- 时间离散化 ---
TIME_HORIZON_HOURS = 24
TIME_STEP_MINUTES = 30
TOTAL_TIME_STEPS = int(TIME_HORIZON_HOURS * 60 / TIME_STEP_MINUTES)
TIME_STEP_HOURS = TIME_STEP_MINUTES / 60.0

# --- 经济与惩罚参数 ---
MANPOWER_COST_PER_HOUR = 150.0
DELAY_PENALTY_PER_HOUR = 500.0
FIXED_SWAP_COST = 50.0
EV_UNSERVED_PENALTY_PER_KWH = 10.0
GRID_PEAK_PRICE_PENALTY = 50.0
UNASSIGNED_TASK_PENALTY = 2000000.0
AVG_TASKS_PER_TRUCK = 5
MAX_WORKING_HOURS_PER_TRUCK = 12.0 # 增加工作时长上限

# --- [新增] 软约束惩罚 ---
# 这是一个极高的惩罚，用于惩罚违反最小SOC约束的行为。
# 它确保模型只有在万不得已（即无法找到任何不违规的方案来服务任务时）才会选择违规。
SOC_VIOLATION_PENALTY_PER_KWH = 50000.0

# --- 电网物理参数 ---
BASE_VOLTAGE_KV = 10.0
BASE_POWER_MVA = 1.0
LINE_RESISTANCE_OHM_PER_KM = 0.16
LINE_REACTANCE_OHM_PER_KM = 0.12
MIN_VOLTAGE_PU = 0.95
MAX_VOLTAGE_PU = 1.05
LINE_THERMAL_LIMIT_MVA = 2.0

# --- [最终修正] HDT 物理参数 ---
LOADING_UNLOADING_TIME_HOURS = 0.5
SWAP_DURATION_HOURS = 0.25
HDT_BATTERY_CAPACITY_KWH = 350.0
HDT_MIN_SOC_KWH = HDT_BATTERY_CAPACITY_KWH * 0.15
HDT_EMPTY_WEIGHT_TON = 10.0
HDT_BASE_CONSUMPTION_KWH_PER_KM = 1.1
HDT_WEIGHT_CONSUMPTION_KWH_PER_KM_TON = 0.05

# --- EV & 能源站参数 ---
EV_AVG_CHARGE_DEMAND_KWH = 40.0
EV_MAX_CHARGE_POWER_KW = 60.0
BATTERY_CHARGE_EFFICIENCY = 0.95
BATTERY_DISCHARGE_EFFICIENCY = 0.95
BATTERY_MAX_CHARGE_POWER_KW = 120
STATION_MAX_GRID_POWER_KW = 2000
PV_PEAK_POWER_KW = 500


# 平均每个换电站每小时到达的EV数量
EV_LAMBDA_PER_HOUR = 2.0


# --- 求解器与模型 ---
SOLVER_NAME = 'gurobi'
TIME_LIMIT_SECONDS = 600
BIG_M = 10000